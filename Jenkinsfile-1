pipeline {
    agent none  // 不指定全局的服务器, 每个stage都要定义自己的agent{...}
    environment {	// 下面的stage都可以使用这个变量
		    NEW_VERSION = '1.3.0'
	  }
    
    tools {
		    maven 'Maven'
	  }
    
    parameters {
        choice(name: 'VERSION', choices: ['1.1.0', '1.2.0', '1.3.0'], description: '')
        booleanParam(name: 'executeTests', defaultValue: true, description: '')
    }
    stages {
        
        stage('build') {
            when {
                expression {
                    env.BRANCH_NAME == 'dev'
                }
            }
            agent {
				        node {
					          label 'test-server'
				        }
			      }
            steps {
                echo "${NEW_VERSION}"   // 双引号会解析NEW_VERSION，单引号则会原样输出
                echo '${NEW_VERSION}'
                sh 'mvn --version'
            }
        }
        
        stage('test') {
            when {
                expression {
                    params.executeTests == true
                }
            }
        
            steps {
                echo "testing version ${params.VERSION}"
            }
        }
    }
	
	post {
		  always {
			    echo 'Here is the always condition ...'
		  }
		  success {
			    echo 'Here is the success condition ...'
		  }
		  failure {
			    echo 'Here is the failure condition ...'
		  }
	}
}
